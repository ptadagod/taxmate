<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TaxMate NZ</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,sans-serif}

body{
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
color:#fff;
padding:20px;
overflow:hidden;
background:#0f1117;
position:relative;
}

/* Animated Background */
body::before{
content:"";
position:fixed;
inset:-50%;
background:
radial-gradient(circle at 20% 30%, rgba(0,255,136,0.12), transparent 40%),
radial-gradient(circle at 80% 70%, rgba(0,120,255,0.10), transparent 40%);
animation:moveGradient 30s ease-in-out infinite alternate;
z-index:-2;
}
@keyframes moveGradient{
0%{transform:translate(0%,0%) scale(1)}
100%{transform:translate(10%,-10%) scale(1.1)}
}

/* Loader */
.loader{
position:fixed;
inset:0;
background:#0f1117;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
z-index:100;
transition:opacity .8s ease, visibility .8s;
}
.loader.hidden{opacity:0;visibility:hidden;}

.loader-title{
font-size:28px;
letter-spacing:4px;
margin-bottom:20px;
opacity:0;
animation:fadeIn 1.2s forwards;
}

.loader-disclaimer{
max-width:420px;
text-align:center;
font-size:14px;
line-height:1.6;
opacity:0;
animation:fadeIn 1.5s forwards;
animation-delay:1s;
opacity:.7;
}

.progress-container{
width:220px;
height:3px;
background:rgba(255,255,255,0.15);
margin-top:30px;
border-radius:3px;
overflow:hidden;
}
.progress-bar{
height:100%;
width:0%;
background:#00ff88;
transition:width .2s linear;
}

@keyframes fadeIn{to{opacity:1}}

/* Card */
.card{
width:100%;
max-width:600px;
padding:34px;
border-radius:24px;
background:rgba(255,255,255,0.05);
border:1px solid rgba(255,255,255,0.08);
backdrop-filter:blur(20px);
box-shadow:0 20px 60px rgba(0,0,0,0.6);
}

/* Inputs */
.input-group{margin-bottom:18px}
label{font-size:13px;opacity:.6;display:block;margin-bottom:6px}

input{
width:100%;
padding:14px;
border-radius:14px;
border:1px solid rgba(255,255,255,0.12);
background:rgba(255,255,255,0.06);
color:#fff;
font-size:15px;
}
input:focus{outline:none;border-color:#00ff88}

/* Segmented */
.segmented{
display:flex;
gap:8px;
margin-bottom:20px;
}
.segmented button{
flex:1;
padding:10px;
border-radius:12px;
border:1px solid rgba(255,255,255,0.15);
background:rgba(255,255,255,0.05);
color:#fff;
cursor:pointer;
transition:.2s;
}
.segmented button.active{
background:#00ff88;
color:#000;
border-color:#00ff88;
}

/* Advanced */
.advanced-toggle{
font-size:13px;
opacity:.7;
cursor:pointer;
margin-bottom:10px;
}
.advanced{display:none;margin-bottom:20px}

/* Switch */
.switch{position:relative;width:46px;height:24px}
.switch input{display:none}
.slider{
position:absolute;inset:0;
background:rgba(255,255,255,0.2);
border-radius:50px;transition:.3s;
}
.slider:before{
content:"";position:absolute;
height:18px;width:18px;
left:3px;top:3px;
background:#fff;border-radius:50%;
transition:.3s;
}
.switch input:checked + .slider{background:#00ff88}
.switch input:checked + .slider:before{transform:translateX(22px)}

/* Button */
.calculate-btn{
width:100%;
padding:14px;
border-radius:14px;
border:1px solid rgba(255,255,255,0.2);
background:rgba(255,255,255,0.08);
color:#fff;
cursor:pointer;
transition:.15s;
}
.calculate-btn:active{transform:scale(.97)}

/* Result */
.result{
margin-top:28px;
opacity:0;
transform:translateY(20px);
transition:.4s ease;
}
.result.show{
opacity:1;
transform:translateY(0);
}

.split{display:flex;gap:15px;margin-bottom:20px}
.box{
flex:1;
padding:16px;
border-radius:14px;
background:rgba(255,255,255,0.05);
text-align:center;
}

.amount{
font-size:22px;
font-weight:700;
margin-top:6px;
}

.row{
display:flex;
justify-content:space-between;
font-size:14px;
margin-top:8px;
opacity:0;
animation:fadeRow .4s forwards;
}
@keyframes fadeRow{to{opacity:1}}

@media(max-width:600px){
.split{flex-direction:column}
}
</style>
</head>
<body>

<div class="loader" id="loader">
<div class="loader-title">TAXMATE</div>
<div class="loader-disclaimer">
This calculator provides an estimate only.  
Results may differ from your official IRD assessment.
</div>
<div class="progress-container">
<div class="progress-bar" id="progressBar"></div>
</div>
</div>

<div class="card">

<div class="input-group">
<label>Gross Income</label>
<input id="income" type="text" placeholder="54,053.19">
</div>

<div class="input-group">
<label>PAYE Deducted</label>
<input id="paye" type="text" placeholder="10,099.44">
</div>

<label>Tax Code</label>
<div class="segmented">
<button data-code="M" class="active">M</button>
<button data-code="ME">ME</button>
<button data-code="S">S</button>
<button data-code="SH">SH</button>
</div>

<div class="advanced-toggle" onclick="toggleAdvanced()">Advanced Options</div>
<div class="advanced" id="advanced">
<div style="display:flex;justify-content:space-between;align-items:center">
<span style="font-size:14px;opacity:.7">Student Loan</span>
<label class="switch">
<input type="checkbox" id="studentLoan">
<span class="slider"></span>
</label>
</div>
</div>

<button class="calculate-btn" onclick="calculate()">Calculate</button>

<div class="result" id="result">
<div class="split">
<div class="box">
<div>With IETC</div>
<div class="amount" id="with"></div>
</div>
<div class="box">
<div>Without IETC</div>
<div class="amount" id="without"></div>
</div>
</div>
<div id="breakdown"></div>
</div>

</div>

<script>
/* Loader Progress */
const loader=document.getElementById("loader");
const progressBar=document.getElementById("progressBar");
let progress=0;
const duration=3000;
const intervalTime=30;
const increment=100/(duration/intervalTime);
const interval=setInterval(()=>{
progress+=increment;
if(progress>=100){
progress=100;
clearInterval(interval);
setTimeout(()=>loader.classList.add("hidden"),200);
}
progressBar.style.width=progress+"%";
},intervalTime);

/* Tax Code */
let taxCode="M";
document.querySelectorAll(".segmented button").forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll(".segmented button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
taxCode=btn.dataset.code;
};
});

function toggleAdvanced(){
const adv=document.getElementById("advanced");
adv.style.display=adv.style.display==="block"?"none":"block";
}

function parse(id){
return parseFloat(document.getElementById(id).value.replace(/,/g,""));
}

function formatInput(el){
let val=el.value.replace(/,/g,"");
if(!isNaN(val)&&val!==""){
el.value=Number(val).toLocaleString("en-NZ");
}
}
["income","paye"].forEach(id=>{
document.getElementById(id).addEventListener("blur",e=>formatInput(e.target));
});

/* Tax Breakdown */
function calculateTaxBreakdown(income){
const brackets=[
{limit:15600,rate:0.105},
{limit:53500,rate:0.175},
{limit:78100,rate:0.30},
{limit:180000,rate:0.33},
{limit:Infinity,rate:0.39}
];

let remaining=income;
let previousLimit=0;
let totalTax=0;
let breakdown=[];

for(let b of brackets){
if(remaining<=0)break;

const taxable=Math.min(remaining,b.limit-previousLimit);
const tax=taxable*b.rate;

breakdown.push({rate:b.rate,income:taxable,tax});
totalTax+=tax;
remaining-=taxable;
previousLimit=b.limit;
}

return{totalTax,breakdown};
}

function ietc(i){
if(i<24000)return 0;
if(i<=66000)return 520;
if(i<70000)return Math.max(0,520-0.13*(i-66000));
return 0;
}

function studentLoan(i){
const threshold=22828;
if(i<=threshold)return 0;
return(i-threshold)*0.12;
}

function currency(v){
return v.toLocaleString("en-NZ",{style:"currency",currency:"NZD"});
}

function animateNumber(el,end){
let start=0,duration=700,startTime=null;
function step(ts){
if(!startTime)startTime=ts;
let progress=ts-startTime;
let percent=Math.min(progress/duration,1);
let value=start+(end-start)*percent;
el.innerText=currency(value);
if(progress<duration)requestAnimationFrame(step);
}
requestAnimationFrame(step);
}

function calculate(){
const income=parse("income");
const paye=parse("paye");
if(!income||!paye)return;

const taxData=calculateTaxBreakdown(income);
const incomeTax=taxData.totalTax;
const acc=income*0.0167;
const sl=document.getElementById("studentLoan").checked?studentLoan(income):0;
let credit=taxCode==="M"?ietc(income):0;

const totalWithout=incomeTax+acc+sl;
const totalWith=totalWithout-credit;

const refundWith=paye-totalWith;
const refundWithout=paye-totalWithout;

document.getElementById("result").classList.add("show");

const withEl=document.getElementById("with");
const withoutEl=document.getElementById("without");

withEl.style.color=refundWith>=0?"#00ff88":"#ff3b3b";
withoutEl.style.color=refundWithout>=0?"#00ff88":"#ff3b3b";

animateNumber(withEl,refundWith);
animateNumber(withoutEl,refundWithout);

let bracketHTML="";
taxData.breakdown.forEach(b=>{
bracketHTML+=`
<div class="row">
<span>${(b.rate*100).toFixed(1)}% on ${currency(b.income)}</span>
<span>${currency(b.tax)}</span>
</div>`;
});

document.getElementById("breakdown").innerHTML=`
${bracketHTML}
<div class="row"><span>Total Income Tax</span><span>${currency(incomeTax)}</span></div>
<div class="row"><span>ACC Levy</span><span>${currency(acc)}</span></div>
<div class="row"><span>Student Loan</span><span>${currency(sl)}</span></div>
<div class="row"><span>IETC</span><span>- ${currency(credit)}</span></div>
`;
}
</script>

</body>
</html>
